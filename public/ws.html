<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>websocket</title>
</head>

<body>
    <input type="text" id="pl" />
    <input type="button" value="发送" id="submit" />
    <input type="button" value="关闭" id="close" />
</body>
<script type="text/javascript">
    // 很重要 必须写，判断浏览器是否支持websocket
    var CreateWebSocket = (function() {
            return function(urlValue) {
                if (window.WebSocket) return new WebSocket(urlValue);
                if (window.MozWebSocket) return new MozWebSocket(urlValue);
                return false;
            }
        })()
        // 实例化websoscket websocket有两种协议ws(不加密)和wss(加密)
    var webSocket = undefined;

    function init() {
        if (webSocket === undefined) {
            webSocket = CreateWebSocket("ws://localhost:5000?Authorization=Bearer%20eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjVjOGE0Mzg5MTA4NmJkN2M5Y2ZmMjEwNSIsInRva2VuX3ZlcnNpb24iOjIxLCJleHBfaXNfbG9uZyI6ZmFsc2UsImlhdCI6MTU2NDU2MjgxNSwiZXhwIjoxNTY0NTcwMDE1LCJpc3MiOiJodHRwOi8vbG9jYWxob3N0In0.kgm_V38MWepJvipP4h83dbCQRzPdIDUZgCqE26GYBJ8");
            webSocket.onopen = function(evt) {
                // 一旦连接成功，就发送第一条数据
                //webSocket.send("第一条数据")
            }
            webSocket.onmessage = function(evt) {
                    // 这是服务端返回的数据
                    console.log("服务端说" + evt.data)
                }
                // 关闭连接
            webSocket.onclose = function(evt) {
                console.log("Connection closed.")
            }

        }
    }
    // input事件发送数据
    init();
    document.getElementById("submit").onclick = function() {
        var str = document.getElementById("pl").value
        webSocket.send(str)
    }
</script>